<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø«Ø±ÙŠØ§ - V7.0 Complete</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyDk5PRsHGgO-i_dIEjOw-j_BjPO9kn--GI", authDomain: "thuraya-platform.firebaseapp.com", projectId: "thuraya-platform", storageBucket: "thuraya-platform.firebasestorage.app", messagingSenderId: "1055940030867", appId: "1:1055940030867:web:d96f6a69a342e98c6d7866", measurementId: "G-2QKJEQR322" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        try { enableIndexedDbPersistence(db); } catch (e) {}
        window.saveToCloudGlobal = async (data) => { try { await setDoc(doc(db, "appData", "mainConfig"), data); return true; } catch (e) { alert("Ø®Ø·Ø£: " + e.message); return false; } };
        window.listenToCloud = (cb) => onSnapshot(doc(db, "appData", "mainConfig"), (doc) => { if (doc.exists()) cb(doc.data()); });
    </script>

    <script type="text/babel" src="admin.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© (V5 Full Structure)
        const initialConfig = {
            settings: { layoutScale: 1 },
            texts: {
                siteTitle: 'Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø«Ø±ÙŠØ§', heroTitle: 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…', heroSubtitle: 'Ø¨ÙŠØ¦Ø© ØªØ±Ø¨ÙˆÙŠØ© Ø¬Ø§Ø°Ø¨Ø©', weeklyQuestion: 'Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ',
                aboutMain: 'Ù†Ø­Ù† Ø­Ù„Ù‚Ø§Øª..', aboutAyah: 'Ùˆ Ø±ØªÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† ØªØ±ØªÙŠÙ„Ø§', aboutFooter: 'Ø´Ø¹Ø§Ø±Ù†Ø§..',
                contact: { phone: '', location: '', youtube: '', facebook: '', instagram: '' }
            },
            news: [], teachers: [], halaqat: [], schedules: []
        };

        const App = () => {
            const [config, setConfig] = useState(initialConfig);
            const [page, setPage] = useState('home');
            const [isAdmin, setIsAdmin] = useState(false);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [toast, setToast] = useState(null);
            
            // Ù†ÙˆØ§ÙØ° Ø§Ù„Ø¯Ø®ÙˆÙ„
            const [passwordInput, setPasswordInput] = useState('');
            const [loginModal, setLoginModal] = useState(false);
            const [securityModal, setSecurityModal] = useState({ show: false, action: null, data: null });

            // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©
            useEffect(() => {
                if (window.listenToCloud) {
                    window.listenToCloud((data) => { if (!isAdmin) setConfig(data); });
                }
            }, [isAdmin]);

            // Ø¯ÙˆØ§Ù„
            const showToast = (msg, type='success') => { setToast({msg, type}); setTimeout(() => setToast(null), 3000); };
            const handleSave = async () => {
                const ok = await window.saveToCloudGlobal(config);
                if(ok) showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…");
            };

            return (
                <div id="app-container" className="pb-20">
                    {/* Ù…ÙƒÙˆÙ†Ø§Øª UI Ø§Ù„Ø¹Ø§Ù…Ø© */}
                    {toast && <div className="toast-container"><div className={`toast ${toast.type}`}>{toast.msg}</div></div>}
                    {!isOnline && <div className="offline-banner">ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ†</div>}
                    <div className="update-btn" onClick={() => window.location.reload()}>ğŸ”„ ØªØ­Ø¯ÙŠØ«</div>

                    {/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */}
                    {loginModal && <div className="modal-overlay" onClick={() => setLoginModal(false)}><div className="modal-content" onClick={e => e.stopPropagation()}><h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h3><input type="password" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} className="border p-2 rounded w-full mb-2 text-center" /><button onClick={() => { if(passwordInput==='12345') { setIsAdmin(true); setPage('admin'); setLoginModal(false); } else alert('Ø®Ø·Ø£'); }} className="bg-green-600 text-white px-4 py-2 rounded w-full">Ø¯Ø®ÙˆÙ„</button></div></div>}

                    {/* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù†Ø§Ù Ø¨Ø§Ø± */}
                    <header className="bg-white p-4 shadow flex justify-between items-center sticky top-0 z-50">
                        <h1 className="font-black text-emerald-800">{config.texts.siteTitle}</h1>
                        <button onClick={() => isAdmin ? setIsAdmin(false) : setLoginModal(true)}>{isAdmin ? 'ğŸ”´ Ø®Ø±ÙˆØ¬' : 'ğŸ”’'}</button>
                    </header>
                    <nav className="bg-white border-b flex overflow-x-auto p-2 gap-2 sticky top-[60px] z-40">
                        {['home','schedules','teachers','students','about'].map(p => <button key={p} onClick={() => setPage(p)} className={`px-4 py-2 rounded text-xs font-bold ${page===p?'bg-emerald-600 text-white':'bg-gray-100'}`}>{p}</button>)}
                    </nav>

                    <main className="p-4">
                        {/* Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª Ù„Ù„Ø²ÙˆØ§Ø± */}
                        {page === 'home' && !isAdmin && (
                            <div className="space-y-6">
                                <div className="bg-emerald-700 text-white p-8 rounded-3xl text-center relative overflow-hidden"><h2 className="relative z-10 text-2xl font-black">{config.texts.heroTitle}</h2><p className="relative z-10 text-sm mt-2">{config.texts.heroSubtitle}</p></div>
                                <div><h3 className="font-bold border-b-2 border-amber-400 inline-block mb-4">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h3>{config.news.filter(n => !n.hidden).map(n => <div key={n.id} className="news-card p-4"><h4 className="font-bold">{n.title}</h4><p className="text-sm text-gray-600">{n.content}</p></div>)}</div>
                            </div>
                        )}
                        
                        {/* ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */}
                        {page === 'schedules' && !isAdmin && (
                            <div className="space-y-4">
                                {config.schedules.filter(s => !s.hidden).map(s => (
                                    <div key={s.id} className="bg-white rounded shadow overflow-hidden">
                                        <div className="bg-emerald-600 text-white p-2 text-center font-bold">{s.name}</div>
                                        <table className="schedule-table"><tbody>{s.days.map((d,i)=><tr key={i}><td>{d.day}</td><td>{d.time}</td><td>{d.note}</td></tr>)}</tbody></table>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† */}
                        {page === 'teachers' && !isAdmin && <div className="grid gap-4">{config.teachers.filter(t=>!t.hidden).map(t=><div className="bg-white p-4 rounded shadow border"><b>{t.name}</b><p className="text-xs">{t.bio}</p></div>)}</div>}

                        {/* ØµÙØ­Ø© Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ */}
                        {page === 'students' && !isAdmin && <div className="space-y-4">{config.halaqat.filter(h=>!h.hidden).map(h=><div className="bg-white rounded shadow p-4"><h4 className="text-center font-bold text-emerald-800 mb-2">{h.name}</h4>{h.students.map(st=><div className="flex justify-between border-b py-1"><span>{st.name}</span><span className="bg-amber-100 px-2 rounded text-xs">{st.rank}</span></div>)}</div>)}</div>}

                        {/* ØµÙØ­Ø© Ù…Ù† Ù†Ø­Ù† */}
                        {page === 'about' && !isAdmin && <div className="bg-white p-6 rounded shadow text-center space-y-4"><p className="leading-loose">{config.texts.aboutMain}</p><div className="font-bold text-emerald-600">{config.texts.aboutAyah}</div><div className="flex justify-center gap-4 mt-4 text-2xl"><a href={config.texts.contact.youtube}>ğŸ“º</a><a href={config.texts.contact.facebook}>facebook</a></div></div>}

                        {/* --- Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ù†ÙØµÙ„ --- */}
                        {isAdmin && window.AdminDashboard && (
                            <window.AdminDashboard 
                                config={config} 
                                setConfig={setConfig} 
                                handleSave={handleSave} 
                                setSecurityModal={setSecurityModal} 
                            />
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    </script>
</body>
</html>
